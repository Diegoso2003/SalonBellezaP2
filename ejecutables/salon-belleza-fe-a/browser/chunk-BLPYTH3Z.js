import{a as z}from"./chunk-DGXXTX47.js";import{a as Q}from"./chunk-URET6IV6.js";import{a as N,b as m,c as O,d as U,e as M,f as P,g as j,h as k,i as w,j as G,k as B,l as L,m as H,n as X,o as R,p as J}from"./chunk-QEQSUI4L.js";import"./chunk-K7U5DLAY.js";import{Ab as D,Ka as r,La as A,Va as p,Vb as y,W as C,Xa as s,Y as E,Yb as q,_a as u,cb as n,db as l,eb as F,fa as T,fb as b,ga as V,gb as g,hb as _,qb as a,sb as x,vb as I,xb as d,yb as S}from"./chunk-TQRRVTAY.js";import"./chunk-2VMXMS7J.js";var f=(t,o)=>({"mb-5":t,"mb-3":o}),h=(t,o)=>({"is-invalid":t,"is-valid":o});function W(t,o){t&1&&a(0," Ingrese un texto ")}function Y(t,o){t&1&&a(0," ingrese un texto valido ")}function Z(t,o){t&1&&a(0," Ingrese el url del video ")}function $(t,o){t&1&&a(0," el url es demasiado largo ")}function ee(t,o){if(t&1&&(n(0,"div",5)(1,"label",12),a(2,"Url del video"),l(),F(3,"input",20),n(4,"div",11),p(5,Z,1,0)(6,$,1,0),l()()),t&2){let i=_();s("ngClass",d(4,f,i.faltaUrlVideo()||i.esUrlVideoInvalido(),!(i.faltaUrlVideo()||i.esUrlVideoInvalido()))),r(3),s("ngClass",d(7,h,i.faltaUrlVideo()||i.esUrlVideoInvalido(),i.esUrlVideoValido())),r(2),u(i.faltaUrlVideo()?5:-1),r(),u(i.esUrlVideoInvalido()?6:-1)}}function ie(t,o){t&1&&a(0," Ingrese la imagen del anuncio ")}function oe(t,o){t&1&&a(0," foto demasiado grande, escoja una menor a 64kb ")}function te(t,o){if(t&1){let i=b();n(0,"div",5)(1,"label",21),a(2,"Imagen del anuncio"),l(),n(3,"input",22),g("change",function(c){T(i);let v=_();return V(v.archivoSeleccionado(c))})("click",function(){T(i);let c=_();return V(c.inputFoto())}),l(),n(4,"div",11),p(5,ie,1,0)(6,oe,1,0),l()()}if(t&2){let i=_();s("ngClass",d(3,f,i.faltaFoto(),!i.faltaFoto())),r(3),s("ngClass",d(6,h,i.faltaFoto(),i.esFotoValida())),r(2),u(i.faltaFoto()?5:6)}}function ne(t,o){t&1&&a(0," Ingrese los dias que estara activo el anuncio ")}function ae(t,o){t&1&&a(0," Ingrese una cantidad valida ")}var K=class t{constructor(o){this.formBuilder=o;this.formAnuncio=this.formBuilder.group({tipo:["",[m.required]],texto:["",[m.required,m.minLength(10),m.maxLength(150)]],fechaPublicacion:["",[m.required]],dias:["",[m.required,m.min(1)]]}),this.validadorForm=new Q(this.formAnuncio)}formAnuncio;imagen=null;validadorForm;inputFotoTocado=!1;informacion=C(R);pedirFoto=!1;pedirUrlVideo=!1;precios;precioFinal=0;dias=0;tipo=0;_marketingService=C(z);ngOnInit(){this.obtenerPrecios()}obtenerPrecios(){this._marketingService.obtenerDatosAnuncio().subscribe({next:o=>{this.precios=o},error:o=>{this.informacion.informarError("Error al obtener los precios")}})}enviar(){if(this.formAnuncio.valid){let o=this.formAnuncio.value;o.tipo==="IMAGEN"?this.cargarAnuncioImagen(o):this.cargarAnuncio(o),this.obtenerPrecios()}else this.informacion.informarError("Ingresar los campos requeridos"),this.formAnuncio.markAllAsTouched(),this.inputFotoTocado=!0}cargarAnuncioImagen(o){let i=new FormData;if(i.append("datos",JSON.stringify(o)),this.imagen!==null)i.append("imagen",this.imagen),this._marketingService.crearAnuncioImagen(i).subscribe({next:e=>{this.informacion.informarExito(e.mensaje),this.limpiar()},error:e=>{this.informacion.informarError(e.error.mensaje||"Error al crear el anuncio")}});else{this.informacion.informarError("Seleccionar una imagen"),this.inputFotoTocado=!0;return}}cargarAnuncio(o){this._marketingService.crearAnuncio(o).subscribe({next:i=>{this.informacion.informarExito(i.mensaje),this.limpiar()},error:i=>{this.informacion.informarError(i.error.mensaje||"Error al crear el anuncio")}})}tipoSeleccionado(o){let e=o.target.value;e==="IMAGEN"?(this.pedirFoto=!0,this.pedirUrlVideo=!1,this.quitarVideo(),this.tipo=this.precios.imagen):e==="VIDEO"?(this.pedirFoto=!1,this.pedirUrlVideo=!0,this.inputFotoTocado=!1,this.agregarVideo(),this.tipo=this.precios.video):(this.inputFotoTocado=!1,this.pedirFoto=!1,this.pedirUrlVideo=!1,this.quitarVideo(),this.tipo=this.precios.texto),this.imagen=null,this.precioFinal=this.dias*this.tipo}diasSeleccionados(o){let e=o.target.value,c=parseInt(e);!isNaN(c)&&c>0?(this.dias=c,this.precioFinal=this.dias*this.tipo):(this.dias=0,this.precioFinal=0)}quitarVideo(){this.formAnuncio.contains("urlVideo")&&this.formAnuncio.removeControl("urlVideo")}agregarVideo(){this.formAnuncio.contains("urlVideo")||this.formAnuncio.addControl("urlVideo",this.formBuilder.control("",[m.required,m.maxLength(250)]))}limpiar(){this.formAnuncio.reset(),this.imagen=null,this.inputFotoTocado=!1,this.pedirFoto=!1,this.pedirUrlVideo=!1,this.precioFinal=0,this.dias=0,this.tipo=0,this.quitarVideo()}archivoSeleccionado(o){let i=o.target;i.files&&i.files.length>0?this.imagen=i.files[0]:this.imagen=null}inputFoto(){this.inputFotoTocado=!0}faltaTipo(){return this.validadorForm.hasErrors("tipo","required")}esTipoValido(){return this.validadorForm.esValido("tipo")}faltaTexto(){return this.validadorForm.hasErrors("texto","required")}esTextoInvalido(){return this.validadorForm.hasErrors("texto","minlength")||this.validadorForm.hasErrors("texto","maxlength")}esTextoValido(){return this.validadorForm.esValido("texto")}faltaFecha(){return this.validadorForm.hasErrors("fechaPublicacion","required")}esFechaValida(){return this.validadorForm.esValido("fechaPublicacion")}faltaDias(){return this.validadorForm.hasErrors("dias","required")}sonDiasInvalidos(){return this.validadorForm.hasErrors("dias","min")}sonDiasValidos(){return this.validadorForm.esValido("dias")}faltaUrlVideo(){return this.validadorForm.hasErrors("urlVideo","required")}esUrlVideoInvalido(){return this.validadorForm.hasErrors("urlVideo","maxlength")}esUrlVideoValido(){return this.validadorForm.esValido("urlVideo")}faltaFoto(){return this.imagen===null&&this.inputFotoTocado}esFotoValida(){return this.imagen!==null&&this.inputFotoTocado}static \u0275fac=function(i){return new(i||t)(A(H))};static \u0275cmp=E({type:t,selectors:[["app-form-anuncio"]],standalone:!0,features:[I],decls:47,vars:44,consts:[[1,"d-flex","align-items-center","justify-content-center"],[1,"card","w-25","m-3","shadow"],[1,"card-body","custom-card"],[1,"card-title","text-center","mb-3"],["novalidate","",1,"needs-validation",3,"submit","formGroup"],[1,"position-relative",3,"ngClass"],["for","rol",1,"form-label"],["aria-label","Default select example","required","","formControlName","tipo",1,"form-select","is-valid",3,"change","ngClass"],["value","TEXTO"],["value","VIDEO"],["value","IMAGEN"],[1,"invalid-tooltip"],["for","validationTooltip01",1,"form-label"],["rows","3","id","validationTooltip01","formControlName","texto","required","",1,"form-control",3,"ngClass"],["for","validationTooltip02",1,"form-label"],["type","date","id","validationTooltip02","formControlName","fechaPublicacion","required","",1,"form-control",3,"ngClass"],["type","number","id","validationTooltip01","formControlName","dias","required","",1,"form-control",3,"change","ngClass"],["for","validationTooltip03",1,"form-label"],[1,"mb-3","d-flex","justify-content-center"],["type","submit",1,"custom-button"],["type","url","id","validationTooltip01","formControlName","urlVideo","required","",1,"form-control",3,"ngClass"],["for","validationTooltip05",1,"form-label"],["type","file","accept","image/*","id","validationTooltip05","required","",1,"form-control",3,"change","click","ngClass"]],template:function(i,e){i&1&&(F(0,"app-informacion"),n(1,"div",0)(2,"div",1)(3,"div",2)(4,"h5",3),a(5,"Publicar anuncio"),l(),n(6,"form",4),g("submit",function(){return e.enviar()}),n(7,"div",5)(8,"label",6),a(9,"Tipo de anuncio"),l(),n(10,"select",7),g("change",function(v){return e.tipoSeleccionado(v)}),n(11,"option",8),a(12,"Anuncio de texto"),l(),n(13,"option",9),a(14,"Anuncio de texto y video"),l(),n(15,"option",10),a(16,"Anuncio de texto e imagen"),l()(),n(17,"div",11),a(18,"seleccione un tipo de anuncio"),l()(),n(19,"div",5)(20,"label",12),a(21,"Texto del anuncio"),l(),F(22,"textarea",13),n(23,"div",11),p(24,W,1,0)(25,Y,1,0),l()(),p(26,ee,7,10,"div",5)(27,te,7,9,"div",5),n(28,"div",5)(29,"label",14),a(30,"Fecha de publicacion"),l(),F(31,"input",15),n(32,"div",11),a(33,"Ingrese la fecha"),l()(),n(34,"div",5)(35,"label",12),a(36,"Dias que estara activo el anuncio"),l(),n(37,"input",16),g("change",function(v){return e.diasSeleccionados(v)}),l(),n(38,"div",11),p(39,ne,1,0)(40,ae,1,0),l()(),n(41,"label",17),a(42),S(43,"currency"),l(),n(44,"div",18)(45,"button",19),a(46,"Publicar"),l()()()()()()),i&2&&(r(6),s("formGroup",e.formAnuncio),r(),s("ngClass",d(20,f,e.faltaTipo(),!e.faltaTipo())),r(3),s("ngClass",d(23,h,e.faltaTipo(),e.esTipoValido())),r(9),s("ngClass",d(26,f,e.faltaTexto()||e.esTextoInvalido(),!(e.faltaTexto()||e.esTextoInvalido()))),r(3),s("ngClass",d(29,h,e.faltaTexto()||e.esTextoInvalido(),e.esTextoValido())),r(2),u(e.faltaTexto()?24:25),r(2),u(e.pedirUrlVideo?26:-1),r(),u(e.pedirFoto?27:-1),r(),s("ngClass",d(32,f,e.faltaFecha(),!e.faltaFecha())),r(3),s("ngClass",d(35,h,e.faltaFecha(),e.esFechaValida())),r(3),s("ngClass",d(38,f,e.faltaDias()||e.sonDiasInvalidos(),!(e.faltaDias()||e.sonDiasInvalidos()))),r(3),s("ngClass",d(41,h,e.faltaDias()||e.sonDiasInvalidos(),e.sonDiasValidos())),r(2),u(e.faltaDias()?39:-1),r(),u(e.sonDiasInvalidos()?40:-1),r(2),x("Precio del anuncio: ",D(43,15,e.precioFinal,"Q","symbol","1.2-2"),""))},dependencies:[J,X,M,G,B,N,P,w,O,U,L,j,k,y,q]})};export{K as FormAnuncioComponent};
