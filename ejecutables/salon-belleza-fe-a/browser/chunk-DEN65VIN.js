import{a as Y}from"./chunk-VG6MFNQK.js";import{a as te}from"./chunk-2ZKC73YP.js";import{a as Z,b as ee}from"./chunk-OCPFQW2A.js";import{a as W}from"./chunk-URET6IV6.js";import{a as $,b as G,c as q,d as z,e as R,g as H,h as L,l as U,m as Q,n as J,o as b,p as K}from"./chunk-QEQSUI4L.js";import{a as X}from"./chunk-K7U5DLAY.js";import"./chunk-H2DLJ7WX.js";import{Ab as P,Ka as m,La as V,Q as N,Va as x,Vb as M,W as s,Xa as l,Y as d,Yb as O,_a as h,ab as B,bb as j,bc as k,cb as a,db as n,eb as f,gb as v,hb as C,qb as o,sb as c,tb as w,vb as p,xb as A,yb as _,zb as D}from"./chunk-TQRRVTAY.js";import"./chunk-2VMXMS7J.js";var u=class i{_http=s(k);url=`${X}/empleado`;constructor(){}obtenerAgenda(t){return this._http.post(`${this.url}/agenda`,t)}marcarCitaAtendida(t){return this._http.patch(`${this.url}/cita_atendida/${t}`,{})}marcarClienteAusente(t){return this._http.patch(`${this.url}/cita_ausente/${t}`,{})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};var ae=(i,t)=>({"mb-5":i,"mb-3":t}),ne=(i,t)=>({"is-invalid":i,"is-valid":t}),S=class i{constructor(t){this.formBuilder=t;this.agendaForm=this.formBuilder.group({fecha:["",[G.required]]}),this.validador=new W(this.agendaForm)}agendaForm;validador;informacion=s(b);usuarioService=s(Y);empleadoService=s(u);informeCambio;citas;faltaFecha(){return this.validador.hasErrors("fecha","required")}esFechaValida(){return this.validador.esValido("fecha")}enviar(){if(this.agendaForm.valid){let t=this.armarDTO();this.realizarConsulta(t)}else this.agendaForm.markAllAsTouched(),this.informacion.informarError("Ingrese una fecha para realizar la consulta")}armarDTO(){let t=this.agendaForm.value;return t.dpi=this.usuarioService.getToken()||"",t}realizarConsulta(t){this.empleadoService.obtenerAgenda(t).subscribe({next:e=>{this.vaciarLista(),this.agregarNuevasCitas(e),this.informeCambio.setCambio(!0),this.informeCambio.setFecha(t.fecha)},error:e=>{this.informacion.informarError(e.error.mensaje||"Error al obtener la agenda"),console.error(e)}})}vaciarLista(){this.citas.length=0}agregarNuevasCitas(t){this.citas.push(...t)}static \u0275fac=function(e){return new(e||i)(V(Q))};static \u0275cmp=d({type:i,selectors:[["app-form-agenda"]],inputs:{informeCambio:"informeCambio",citas:"citas"},standalone:!0,features:[p],decls:15,vars:9,consts:[[1,"d-flex","align-items-center","justify-content-center"],[1,"card","w-25","m-3","shadow"],[1,"card-body","custom-card"],[1,"card-title","text-center","mb-3"],["novalidate","",1,"needs-validation",3,"submit","formGroup"],[1,"position-relative",3,"ngClass"],["for","validationTooltip02",1,"form-label"],["type","date","id","validationTooltip02","formControlName","fecha","required","",1,"form-control",3,"ngClass"],[1,"invalid-tooltip"],[1,"mb-3","d-flex","justify-content-center"],["type","submit",1,"custom-button"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),o(4,"Consulta agenda por dia"),n(),a(5,"form",4),v("submit",function(){return r.enviar()}),a(6,"div",5)(7,"label",6),o(8,"Fecha"),n(),f(9,"input",7),a(10,"div",8),o(11,"Ingrese una fecha"),n()(),a(12,"div",9)(13,"button",10),o(14,"Realizar consulta"),n()()()()()()),e&2&&(m(5),l("formGroup",r.agendaForm),m(),l("ngClass",A(3,ae,r.faltaFecha(),!r.faltaFecha())),m(3),l("ngClass",A(6,ne,r.faltaFecha(),r.esFechaValida())))},dependencies:[M,J,R,$,q,z,U,H,L]})};function oe(i,t){if(i&1&&(a(0,"h6",0),o(1,"Informacion del empleado asignado"),n(),a(2,"p",1),o(3),n(),a(4,"p",1),o(5),n(),a(6,"p",1),o(7),n()),i&2){let e=C();m(3),c("Nombre: ",e.cita.empleado.nombre,""),m(2),c("Telefono: ",e.cita.empleado.telefono,""),m(2),c("DPI: ",e.cita.empleado.dpi,"")}}function re(i,t){if(i&1&&(a(0,"h6",0),o(1,"Informacion del cliente"),n(),a(2,"p",1),o(3),n(),a(4,"p",1),o(5),n(),a(6,"p",1),o(7),n()),i&2){let e=C();m(3),c("Nombre: ",e.cita.cliente.nombre,""),m(2),c("Telefono: ",e.cita.cliente.telefono,""),m(2),c("DPI: ",e.cita.cliente.dpi,"")}}var E=class i{cita;vistaCliente=!0;vistaAdmin=!1;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-vista-cita"]],inputs:{cita:"cita",vistaCliente:"vistaCliente",vistaAdmin:"vistaAdmin"},standalone:!0,features:[p],decls:15,vars:16,consts:[[1,"card-subtitle","text-center"],[1,"card-text"]],template:function(e,r){e&1&&(a(0,"h6",0),o(1,"Detalles de la cita"),n(),a(2,"p",1),o(3),n(),a(4,"p",1),o(5),_(6,"horaPipe"),_(7,"horaPipe"),n(),a(8,"p",1),o(9),n(),a(10,"p",1),o(11),_(12,"currency"),n(),x(13,oe,8,3)(14,re,8,3)),e&2&&(m(3),c("Fecha de la cita: ",r.cita.fecha,""),m(2),w("Horario de atencio: ",D(6,7,r.cita.hora)," - ",D(7,9,r.cita.horaFin),""),m(4),c("Nombre del servicio: ",r.cita.servicio.nombreServicio,""),m(2),c("Precio del servicio: ",P(12,11,r.cita.servicio.precio,"Q","symbol","1.2-2"),""),m(2),h(r.vistaCliente||r.vistaAdmin?13:-1),m(),h(!r.vistaCliente||r.vistaAdmin?14:-1))},dependencies:[te,O]})};var I=class i{idCita;citas;empleadoService=s(u);informacion=s(b);agendarCitaAtendida(){this.empleadoService.marcarCitaAtendida(this.idCita).subscribe({next:()=>{this.informacion.informarExito("Cita marcada como atendida"),this.borrarCita()},error:t=>{this.informacion.informarError(t.error.mensaje||"Error al marcar la cita como atendida")}})}borrarCita(){let t=this.citas.findIndex(e=>e.idCita===this.idCita);t!==-1&&this.citas.splice(t,1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-boton-atendida"]],inputs:{idCita:"idCita",citas:"citas"},standalone:!0,features:[p],decls:2,vars:0,consts:[["type","button",1,"btn","btn-sm","custom-button",3,"click"]],template:function(e,r){e&1&&(a(0,"button",0),v("click",function(){return r.agendarCitaAtendida()}),o(1,"Marcar cita como atendida"),n())}})};var y=class i{idCita;citas;informacion=s(b);empleadoService=s(u);agendarCitaAusente(){this.empleadoService.marcarClienteAusente(this.idCita).subscribe({next:()=>{this.informacion.informarExito("Cliente marcado como ausente"),this.borrarCita()},error:t=>{this.informacion.informarError(t.error.mensaje||"Error al marcar al cliente como ausente")}})}borrarCita(){let t=this.citas.findIndex(e=>e.idCita===this.idCita);t!==-1&&this.citas.splice(t,1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-boton-ausente"]],inputs:{idCita:"idCita",citas:"citas"},standalone:!0,features:[p],decls:2,vars:0,consts:[["type","button",1,"btn","btn-sm","custom-button",3,"click"]],template:function(e,r){e&1&&(a(0,"button",0),v("click",function(){return r.agendarCitaAusente()}),o(1,"Marcar cliente como ausente"),n())}})};var me=(i,t)=>t.idCita;function se(i,t){if(i&1&&f(0,"app-form-agenda",0),i&2){let e=C();l("informeCambio",e.informeCambio)("citas",e.citas)}}function ce(i,t){if(i&1&&(a(0,"div",1)(1,"div",4)(2,"div",5),f(3,"app-vista-cita",6)(4,"br"),a(5,"div",7)(6,"div",8),f(7,"app-boton-atendida",9)(8,"app-boton-ausente",9),n()()()()()),i&2){let e=t.$implicit,r=C(2);m(3),l("cita",e)("vistaCliente",!1),m(4),l("citas",r.citas)("idCita",e.idCita),m(),l("citas",r.citas)("idCita",e.idCita)}}function de(i,t){i&1&&(a(0,"div",1)(1,"div",10),o(2,"Sin citas asignadas"),n()())}function le(i,t){if(i&1&&(a(0,"div",1),f(1,"app-boton-atras",2),a(2,"div",3),o(3),n()(),B(4,ce,9,6,"div",1,me,!1,de,3,0,"div",1)),i&2){let e=C();m(),l("informe",e.informeCambio),m(2),c(" Citas del dia: ",e.informeCambio.getFecha()," "),m(),j(e.citas)}}var ie=class i{informeCambio=new Z;citas=[];static \u0275fac=function(e){return new(e||i)};static \u0275cmp=d({type:i,selectors:[["app-vista-citas"]],standalone:!0,features:[p],decls:3,vars:1,consts:[[3,"informeCambio","citas"],[1,"d-flex","align-items-center","justify-content-center"],[3,"informe"],[1,"h3","text-center","m-3"],[1,"card","w-25","m-3","shadow"],[1,"card-body","custom-card"],[3,"cita","vistaCliente"],[1,"d-flex","justify-content-between","align-items-center"],[1,"d-flex","gap-2"],[3,"citas","idCita"],["role","alert",1,"alert","alert-warning","w-25"]],template:function(e,r){e&1&&(f(0,"app-informacion"),x(1,se,1,2,"app-form-agenda",0)(2,le,7,3)),e&2&&(m(),h(r.informeCambio.getCambio()?2:1))},dependencies:[K,S,E,ee,I,y]})};export{ie as VistaCitasComponent};
