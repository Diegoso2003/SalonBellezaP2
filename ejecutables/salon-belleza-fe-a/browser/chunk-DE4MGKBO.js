import{a as Q,b as W}from"./chunk-X465SVL7.js";import{a as J,b as K}from"./chunk-LPJ2IT5O.js";import{a as z}from"./chunk-6VF6MSZ4.js";import{a as _}from"./chunk-JXNCFO7G.js";import{a as $}from"./chunk-VG6MFNQK.js";import"./chunk-DGXXTX47.js";import{a as H}from"./chunk-2ZKC73YP.js";import{a as k}from"./chunk-URET6IV6.js";import{a as P,b as j,c as U,d as A,e as B,g as w,h as q,l as G,m as L,n as g,o as v,p as R}from"./chunk-QEQSUI4L.js";import"./chunk-K7U5DLAY.js";import{c as M}from"./chunk-H2DLJ7WX.js";import{$a as x,Ka as t,La as D,Va as E,Vb as V,W as s,Xa as l,Y as p,_a as S,ab as O,bb as N,cb as a,db as n,eb as m,gb as I,hb as C,qb as c,tb as F,vb as d,xb as b,yb as u,zb as f}from"./chunk-TQRRVTAY.js";import"./chunk-2VMXMS7J.js";function re(r,i){if(r&1&&(a(0,"li",2),c(1),u(2,"horaPipe"),u(3,"horaPipe"),n()),r&2){let e=i.$implicit;t(),F("",f(2,2,e.horaInicio)," - ",f(3,4,e.horaFin),"")}}function te(r,i){r&1&&(a(0,"li",2),c(1," Horario libre "),n())}var y=class r{usuarioSeleccionado;_clienteService=s(_);informacion=s(v);horarioEmpleado=[];ngOnInit(){this.recuperarHorario()}recuperarHorario(){if(this.usuarioSeleccionado.sonAmbosValidos()&&this.usuarioSeleccionado.getUsuarioEncontrado()){let i={dpi:this.usuarioSeleccionado.getUsuarioSeleccionado().dpi,fecha:this.usuarioSeleccionado.getFechaSeleccionada()};this._clienteService.obtenerHorarioEmpleado(i).subscribe({next:e=>{this.horarioEmpleado=e},error:e=>{console.error("Error al obtener el horario del empleado:",e),this.informacion.informarError(e.error.mensaje||"Error al obtener el horario del empleado")}})}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=p({type:r,selectors:[["app-horario-empleado"]],inputs:{usuarioSeleccionado:"usuarioSeleccionado"},standalone:!0,features:[d],decls:6,vars:1,consts:[[1,"card-title","text-center"],[1,"list-group"],[1,"list-group-item"]],template:function(e,o){e&1&&(a(0,"h5",0),c(1,"Horario del empleado"),n(),a(2,"ul",1),O(3,re,4,6,"li",2,x,!1,te,2,0,"li",2),n()),e&2&&(t(3),N(o.horarioEmpleado))},dependencies:[H]})};var Z=(r,i)=>({"mb-5":r,"mb-3":i}),ee=(r,i)=>({"is-invalid":r,"is-valid":i});function ae(r,i){if(r&1&&m(0,"app-form-empleados",12),r&2){let e=C();l("empleadosDisponibles",e.servicio.empleados)("seleccionado",e.usuarioSeleccionado)}}function ne(r,i){if(r&1&&m(0,"app-horario-empleado",13),r&2){let e=C();l("usuarioSeleccionado",e.usuarioSeleccionado)}}var T=class r{constructor(i){this.formBuilder=i;this.citaform=this.formBuilder.group({fecha:["",[j.required]],hora:["",[j.required]]}),this.validadorForm=new k(this.citaform)}servicio;citaform;horarioSalon;informacion=s(v);_usuarioService=s($);_clienteService=s(_);validadorForm;usuarioSeleccionado=new K;mostrarListaEmpleados=!0;ngOnInit(){this.obtenerHorarioSalon()}obtenerHorarioSalon(){this._clienteService.obtenerHorarioSalon().subscribe({next:i=>{this.horarioSalon=i,console.log("Horario del sal\xF3n:",this.horarioSalon)},error:i=>{console.error(i)}})}limpiarFormulario(){this.mostrarListaEmpleados=!1,this.citaform.reset(),this.usuarioSeleccionado.setUsuarioSeleccionado(void 0),this.usuarioSeleccionado.setFechaSeleccionada(null),this.usuarioSeleccionado.setUsuarioEncontrado(!1),setTimeout(()=>{this.mostrarListaEmpleados=!0},20)}enviar(){if(this.citaform.valid)if(this.usuarioSeleccionado.sonAmbosValidos()){let i=this._usuarioService.getToken(),e=this.usuarioSeleccionado.getUsuarioSeleccionado().dpi,o=this.citaform.value;o.dpiCliente=i||"",o.dpiEmpleado=e,o.idServicio=this.servicio.idServicio,this._clienteService.agendarCita(o).subscribe({next:h=>{this.informacion.informarExito(h.mensaje),this.limpiarFormulario()},error:h=>{this.informacion.informarError(h.error.mensaje||"Error al agendar la cita")}})}else this.informacion.informarError("Seleccionar empleado y horario");else this.informacion.informarError("Completar la informacion requerida"),this.citaform.markAllAsTouched()}fechaSeleccionada(i){let o=i.target.value;o.length>0?this.usuarioSeleccionado.setFechaSeleccionada(o):this.usuarioSeleccionado.setFechaSeleccionada(null)}faltaFecha(){return this.validadorForm.hasErrors("fecha","required")}esFechaValida(){return this.validadorForm.esValido("fecha")}faltaHora(){return this.validadorForm.hasErrors("hora","required")}esHoraValida(){return this.validadorForm.esValido("hora")}static \u0275fac=function(e){return new(e||r)(D(L))};static \u0275cmp=p({type:r,selectors:[["app-form-cita-hijo"]],inputs:{servicio:"servicio"},standalone:!0,features:[d],decls:28,vars:25,consts:[[1,"d-flex","align-items-center","justify-content-center"],[1,"card","m-3","shadow",2,"width","40%"],[1,"card-body","custom-card"],[1,"card-title","text-center","mb-3"],["novalidate","",1,"needs-validation",3,"submit","formGroup"],[1,"form-label"],[1,"position-relative",3,"ngClass"],["for","validationTooltip01",1,"form-label"],["type","date","id","validationTooltip01","formControlName","fecha","required","",1,"form-control",3,"change","ngClass"],[1,"invalid-tooltip"],["for","validationTooltip02",1,"form-label"],["type","time","id","validationTooltip02","formControlName","hora","required","",1,"form-control",3,"ngClass"],[3,"empleadosDisponibles","seleccionado"],[3,"usuarioSeleccionado"],[1,"mb-3","d-flex","justify-content-center"],["type","submit",1,"custom-button"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),c(4,"Agendar cita"),n(),a(5,"form",4),I("submit",function(){return o.enviar()}),a(6,"label",5),c(7),u(8,"horaPipe"),u(9,"horaPipe"),n(),a(10,"div",6)(11,"label",7),c(12,"Fecha de la cita"),n(),a(13,"input",8),I("change",function(oe){return o.fechaSeleccionada(oe)}),n(),a(14,"div",9),c(15,"Ingrese una fecha"),n()(),a(16,"div",6)(17,"label",10),c(18,"Hora de la cita"),n(),m(19,"input",11),a(20,"div",9),c(21,"Ingrese una hora"),n()(),E(22,ae,1,2,"app-form-empleados",12)(23,ne,1,1,"app-horario-empleado",13),m(24,"br"),a(25,"div",14)(26,"button",15),c(27,"Agendar cita"),n()()()()()()),e&2&&(t(5),l("formGroup",o.citaform),t(2),F("Horario de atencion: ",f(8,9,o.horarioSalon.horaInicio)," - ",f(9,11,o.horarioSalon.horaFin),""),t(3),l("ngClass",b(13,Z,o.faltaFecha(),!o.faltaFecha())),t(3),l("ngClass",b(16,ee,o.faltaFecha(),o.esFechaValida())),t(3),l("ngClass",b(19,Z,o.faltaHora(),!o.faltaHora())),t(3),l("ngClass",b(22,ee,o.faltaHora(),o.esHoraValida())),t(3),S(o.mostrarListaEmpleados?22:-1),t(),S(o.usuarioSeleccionado.sonAmbosValidos()&&o.usuarioSeleccionado.getUsuarioEncontrado()?23:-1))},dependencies:[g,B,P,U,A,G,w,q,V,J,y,H]})};function le(r,i){if(r&1&&(m(0,"app-vista-anuncio",0)(1,"app-vista-anuncio",0),a(2,"div",1)(3,"div",2),m(4,"app-vista-servicio",3),n()(),m(5,"app-form-cita-hijo",4)),r&2){let e=C();l("derecho",!1),t(),l("derecho",!0),t(3),l("vista_cliente",!0)("vista_individual",!0)("servicio",e.servicio),t(),l("servicio",e.servicio)}}var ie=class r{servicio;servicioObtenido=!1;informacion=s(v);_router=s(M);_servicioService=s(z);ngOnInit(){this.obtenerIdServicio()}obtenerIdServicio(){let i=this._router.snapshot.params.idServicio,e=Number(i);if(console.log(e),isNaN(e)){this.informacion.informarError("El id del servicio no es valido");return}this.obtenerServicio(e)}obtenerServicio(i){this._servicioService.obtenerServicio(i).subscribe({next:e=>{this.servicio=e,this.servicioObtenido=!0},error:e=>{this.informacion.informarError(e.error.mensaje||"Error al cargar el servicio intentar mas tarde"),console.log(e)}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=p({type:r,selectors:[["app-form-cita"]],standalone:!0,features:[d],decls:2,vars:1,consts:[[3,"derecho"],[1,"d-flex","align-items-center","justify-content-center"],[1,"card","m-3","shadow",2,"width","40%"],[3,"vista_cliente","vista_individual","servicio"],[3,"servicio"]],template:function(e,o){e&1&&(m(0,"app-informacion"),E(1,le,6,6)),e&2&&(t(),S(o.servicioObtenido?1:-1))},dependencies:[Q,g,W,R,T]})};export{ie as FormCitaComponent};
